<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Token Monitor</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            background-color: #f5f7fa;
            padding: 20px;
            margin: 0;
        }

        h1 {
            text-align: center;
            color: #333;
        }

        #refreshBtn {
            display: block;
            margin: 20px auto;
            background-color: #007bff;
            color: white;
            border: none;
            padding: 10px 18px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 16px;
        }

        #refreshBtn:hover {
            background-color: #0056b3;
        }

        .grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .card {
            background-color: white;
            border-radius: 12px;
            padding: 16px;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.08);
            transition: transform 0.15s ease-in-out;
        }

        .card:hover {
            transform: translateY(-3px);
        }

        .symbol {
            font-weight: bold;
            font-size: 18px;
            color: #007bff;
        }

        .price {
            font-size: 20px;
            margin: 6px 0;
        }

        .stat {
            font-size: 14px;
            color: #555;
            margin: 2px 0;
        }

        .change-positive {
            font-weight: bold;
            color: #28a745;
            /* Green */
        }

        .change-negative {
            font-weight: bold;
            color: #d9534f;
            /* Red */
        }

        .total-reward {
            font-size: 16px;
            font-weight: bold;
            color: #28a745;
            /* Green for emphasis */
            margin-top: 6px;
        }

        .countdown {
            font-size: 16px;
            font-weight: bold;
            color: #d9534f;
        }

        canvas {
            margin-top: 10px;
        }
    </style>
</head>
<body>

    <h1>Token Monitor</h1>
    <button id="refreshBtn">Refresh</button>

    <div class="grid" id="cardContainer"></div>

    <script>
        const API_URL = "https://www.binance.com/bapi/defi/v1/public/wallet-direct/buw/wallet/cex/alpha/all/token/list";

        // Target symbols & extra data
        const target_symbols = ["ASP", "ZRC", "YALA", "TA", "MIA", "GAME"];
        const reward_vol = [428, 1785, 357, 1000, 740, 20000];
        const deadline = [
            "2025-08-14 00:00 (UTC+8)",
            "2025-08-14 00:00 (UTC+8)",
            "2025-08-14 00:00 (UTC+8)",
            "2025-08-14 00:00 (UTC+8)",
            "2025-08-15 00:00 (UTC+8)",
            "2025-08-24 15:00 (UTC+8)",
        ];

        const FIELDS = [
            "name",
            "symbol",
            "price",
            "percentChange24h",
            "volume24h",
            "marketCap",
            "priceHigh24h",
            "priceLow24h"
        ];

        let latestData = [];

        // Example daily competition data
        const dailyData = {
            "ASP": [0, 0, 18, 58, 1238, 30816, 124686, 249795, 445415, 771099],
            "ZRC": [0, 0, 0, 0, 0, 0, 0, 6154, 105207, 363690],
            "YALA": [0, 66, 9614, 111380, 210655, 249889, 310166, 421932, 696272, 1006749],
            "TA": [0, 0, 0, 13, 745, 6056, 18389, 55405, 181337, 424223],
            "MIA": [0, 0, 0, 0, 0, 0, 0, 0, 0, 50],
            "GAME": [0, 0, 0, 0, 0, 0, 0, 0, 0, 8] // example
        };
        const dates = ["08-04", "08-05", "08-06", "08-07", "08-08", "08-09", "08-10", "08-11", "08-12", "08-13"];

        async function fetchData() {
            try {
                const res = await fetch(API_URL);
                if (!res.ok) throw new Error("Failed to fetch data");
                const json = await res.json();
                const data = json.data || [];

                latestData = target_symbols.map((sym, idx) => {
                    const item = data.find(d => d.symbol === sym) || {};
                    let obj = {};
                    FIELDS.forEach(f => obj[f] = item[f]);
                    obj.rewardVol = reward_vol[idx];
                    obj.deadline = deadline[idx];
                    obj.history = dailyData[sym] || [];
                    return obj;
                });

                renderCards();
            } catch (err) {
                console.error(err);
                document.getElementById("cardContainer").innerHTML = "<p>Error loading data.</p>";
            }
        }

        function renderCards() {
            const container = document.getElementById("cardContainer");
            container.innerHTML = "";
            latestData.forEach((item, idx) => {
                const totalReward = (item.price || 0) * item.rewardVol;
                const deadlineISO = parseDeadline(item.deadline);
                const remaining = formatRemaining(deadlineISO - new Date());
                const change = Number(item.percentChange24h || 0);
                let changeClass = "";
                if (change > 1.5) changeClass = "change-positive";
                else if (change < 0) changeClass = "change-negative";

                const card = document.createElement("div");
                card.className = "card";
                const canvasId = `chart-${item.symbol}`;
                card.innerHTML = `
                <div class="symbol">${item.symbol} - ${item.name || "N/A"}</div>
                <div class="price">$${Number(item.price || 0).toLocaleString()}</div>
                <div class="stat ${changeClass}">24h Change: ${change}%</div>
                <div class="stat">24h Volume: ${Number(item.volume24h || 0).toLocaleString()}</div>
                <div class="stat">Market Cap: $${Number(item.marketCap || 0).toLocaleString()}</div>
                <div class="stat">High 24h: $${Number(item.priceHigh24h || 0).toLocaleString()}</div>
                <div class="stat">Low 24h: $${Number(item.priceLow24h || 0).toLocaleString()}</div>
                <div class="stat">Reward Vol: ${item.rewardVol.toLocaleString()}</div>
                <div class="total-reward">Total Reward: $${totalReward.toLocaleString()}</div>
                <div class="stat">Deadline: ${item.deadline}</div>
                <div class="stat countdown" data-deadline="${deadlineISO}">Time left: ${remaining}</div>
                <canvas id="${canvasId}" height="120"></canvas>
            `;
                container.appendChild(card);

                // Draw chart
                new Chart(document.getElementById(canvasId), {
                    type: 'line',
                    data: {
                        labels: dates,
                        datasets: [{
                            label: 'Daily Vol',
                            data: item.history,
                            borderColor: '#007bff',
                            backgroundColor: 'rgba(0,123,255,0.1)',
                            fill: true,
                            tension: 0.3,
                            pointRadius: 4
                        }]
                    },
                    options: {
                        responsive: true,
                        plugins: {
                            legend: { display: false },
                            datalabels: {
                                color: '#333',
                                anchor: 'end',
                                align: 'top',
                                formatter: (value) => value.toLocaleString()
                            }
                        },
                        scales: {
                            x: {},
                            y: { beginAtZero: true }
                        }
                    },
                    plugins: [ChartDataLabels]
                });
            });
        }

        function parseDeadline(deadlineStr) {
            // Remove (UTC+8) and parse as local UTC+8 time
            const clean = deadlineStr.replace(" (UTC+8)", "").replace(/-/g, "/");
            const date = new Date(clean + " GMT+0800");
            return date;
        }

        function formatRemaining(ms) {
            if (ms <= 0) return "Expired";
            const totalSeconds = Math.floor(ms / 1000);
            const days = Math.floor(totalSeconds / (3600 * 24));
            const hours = Math.floor((totalSeconds % (3600 * 24)) / 3600);
            const minutes = Math.floor((totalSeconds % 3600) / 60);
            const seconds = totalSeconds % 60;
            return `${days}d ${hours}h ${minutes}m ${seconds}s`;
        }

        function updateCountdowns() {
            document.querySelectorAll(".countdown").forEach(el => {
                const deadline = new Date(el.dataset.deadline);
                el.textContent = "Time left: " + formatRemaining(deadline - new Date());
            });
        }

        document.getElementById("refreshBtn").addEventListener("click", fetchData);

        // Update countdown every second
        setInterval(updateCountdowns, 1000);

        // Auto-load on start
        fetchData();
    </script>

</body>
</html>